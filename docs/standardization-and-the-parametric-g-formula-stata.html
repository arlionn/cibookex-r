<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13. Standardization and the parametric G-formula: Stata | Causal Inference: What If. R and Stata code for Exercises</title>
  <meta name="description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="13. Standardization and the parametric G-formula: Stata | Causal Inference: What If. R and Stata code for Exercises" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13. Standardization and the parametric G-formula: Stata | Causal Inference: What If. R and Stata code for Exercises" />
  
  <meta name="twitter:description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

<meta name="author" content="Book by M. A. Hern치n and J. M. Robins" />
<meta name="author" content="R code by Joy Shi and Sean McGrath" />
<meta name="author" content="Stata code by Eleanor Murray and Roger Logan" />
<meta name="author" content="R Markdown code by Tom Palmer" />


<meta name="date" content="2022-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ip-weighting-and-marginal-structural-models-stata.html"/>
<link rel="next" href="g-estimation-of-structural-nested-models-stata.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-code"><i class="fa fa-check"></i>Downloading the code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing-dependency-packages"><i class="fa fa-check"></i>Installing dependency packages</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-datasets"><i class="fa fa-check"></i>Downloading the datasets</a></li>
</ul></li>
<li class="part"><span><b>R code</b></span></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html"><i class="fa fa-check"></i>11. Why model?</a>
<ul>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.2"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.3"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.2"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.3"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.4"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.5"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.6"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.7"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.2"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.3"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.4"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.2"><i class="fa fa-check"></i>Program 14.2</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-one-possible-value-of-psi"><i class="fa fa-check"></i>G-estimation: Checking one possible value of psi</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-multiple-possible-values-of-psi"><i class="fa fa-check"></i>G-estimation: Checking multiple possible values of psi</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.3"><i class="fa fa-check"></i>Program 14.3</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-linear-mean-models"><i class="fa fa-check"></i>G-estimation: Closed form estimator linear mean models</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-for-2-parameter-model"><i class="fa fa-check"></i>G-estimation: Closed form estimator for 2-parameter model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.2"><i class="fa fa-check"></i>Program 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.3"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.4"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.2"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.3"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.4"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.5"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html"><i class="fa fa-check"></i>17. Causal survival analysis</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.2"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.3"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.4"><i class="fa fa-check"></i>Program 17.4</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.5"><i class="fa fa-check"></i>Program 17.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-r.html"><a href="session-information-r.html"><i class="fa fa-check"></i>Session information: R</a></li>
<li class="part"><span><b>Stata code</b></span></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html"><i class="fa fa-check"></i>11. Why model: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.1-1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.2-1"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.3-1"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.1-1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.2-1"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.3-1"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.4-1"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.5-1"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.6-1"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.7-1"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.1-1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.2-1"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.3-1"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.4-1"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.1-1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.2-1"><i class="fa fa-check"></i>Program 14.2</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.3-1"><i class="fa fa-check"></i>Program 14.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.1-1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#prorgam-15.2"><i class="fa fa-check"></i>Prorgam 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.3-1"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.4-1"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html"><i class="fa fa-check"></i>16. Instrumental variables estimation: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.1-1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.2-1"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.3-1"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.4-1"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.5-1"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html"><i class="fa fa-check"></i>17. Causal survival analysis: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.1-1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.2-1"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.3-1"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.4-1"><i class="fa fa-check"></i>Program 17.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-stata.html"><a href="session-information-stata.html"><i class="fa fa-check"></i>Session information: Stata</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference: What If. R and Stata code for Exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="standardization-and-the-parametric-g-formula-stata" class="section level1 unnumbered hasAnchor">
<h1>13. Standardization and the parametric G-formula: Stata<a href="standardization-and-the-parametric-g-formula-stata.html#standardization-and-the-parametric-g-formula-stata" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="standardization-and-the-parametric-g-formula-stata.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Statamarkdown)</span></code></pre></div>
<pre><code>/***************************************************************
Stata code for Causal Inference: What If by Miguel Hernan &amp; Jamie Robins
Date: 10/10/2019
Author: Eleanor Murray 
For errors contact: ejmurray@bu.edu
***************************************************************/</code></pre>
<div id="program-13.1-1" class="section level2 hasAnchor">
<h2>Program 13.1<a href="standardization-and-the-parametric-g-formula-stata.html#program-13.1-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating the mean outcome within levels of treatment and confounders: Data from NHEFS</li>
<li>Section 13.2</li>
</ul>
<div class="sourceCode" id="cb369"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb369-1"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ./<span class="kw">data</span>/nhefs-formatted, <span class="kw">clear</span></span>
<span id="cb369-2"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-3"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* Estimate the the conditional mean outcome within strata of quitting </span></span>
<span id="cb369-4"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="co">smoking and covariates, among the uncensored */</span></span>
<span id="cb369-5"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-5" aria-hidden="true" tabindex="-1"></a><span class="kw">glm</span> wt82_71 qsmk sex race c.age##c.age ib(<span class="fu">last</span>).education <span class="co">///</span></span>
<span id="cb369-6"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-6" aria-hidden="true" tabindex="-1"></a>  c.smokeintensity##c.smokeintensity c.smokeyrs##c.smokeyrs <span class="co">///</span></span>
<span id="cb369-7"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-7" aria-hidden="true" tabindex="-1"></a>  ib(<span class="fu">last</span>).exercise ib(<span class="fu">last</span>).active c.wt71##c.wt71 <span class="co">///</span></span>
<span id="cb369-8"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-8" aria-hidden="true" tabindex="-1"></a>  qsmk##c.smokeintensity</span>
<span id="cb369-9"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-9" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> meanY</span>
<span id="cb369-10"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-10" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> meanY</span>
<span id="cb369-11"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-12"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-12" aria-hidden="true" tabindex="-1"></a><span class="co">/*Look at the predicted value for subject ID = 24770*/</span></span>
<span id="cb369-13"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-13" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> meanY <span class="kw">if</span> seqn == 24770</span>
<span id="cb369-14"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-15"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-15" aria-hidden="true" tabindex="-1"></a><span class="co">/*Observed mean outcome for comparison */</span></span>
<span id="cb369-16"><a href="standardization-and-the-parametric-g-formula-stata.html#cb369-16" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> wt82_71</span></code></pre></div>
<pre><code>note: 1.qsmk omitted because of collinearity.
note: smokeintensity omitted because of collinearity.

Iteration 0:   log likelihood = -5328.5765  

Generalized linear models                         Number of obs   =      1,566
Optimization     : ML                             Residual df     =      1,545
                                                  Scale parameter =    53.5683
Deviance         =  82763.02862                   (1/df) Deviance =    53.5683
Pearson          =  82763.02862                   (1/df) Pearson  =    53.5683

Variance function: V(u) = 1                       [Gaussian]
Link function    : g(u) = u                       [Identity]

                                                  AIC             =   6.832154
Log likelihood   = -5328.576456                   BIC             =   71397.58

-------------------------------------------------------------------------------
              |                 OIM
      wt82_71 | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]
--------------+----------------------------------------------------------------
         qsmk |   2.559594   .8091486     3.16   0.002      .973692    4.145496
          sex |  -1.430272   .4689576    -3.05   0.002    -2.349412   -.5111317
         race |   .5601096   .5818888     0.96   0.336    -.5803714    1.700591
          age |   .3596353   .1633188     2.20   0.028     .0395364    .6797342
              |
  c.age#c.age |   -.006101   .0017261    -3.53   0.000    -.0094841   -.0027178
              |
    education |
           1  |    .194977   .7413692     0.26   0.793     -1.25808    1.648034
           2  |   .9854211   .7012116     1.41   0.160    -.3889285    2.359771
           3  |   .7512894   .6339153     1.19   0.236    -.4911617    1.993741
           4  |   1.686547   .8716593     1.93   0.053    -.0218744    3.394967
              |
smokeintens~y |   .0491365   .0517254     0.95   0.342    -.0522435    .1505165
              |
           c. |
smokeintens~y#|
           c. |
smokeintens~y |  -.0009907    .000938    -1.06   0.291    -.0028292    .0008479
              |
     smokeyrs |   .1343686   .0917122     1.47   0.143     -.045384    .3141212
              |
   c.smokeyrs#|
   c.smokeyrs |  -.0018664   .0015437    -1.21   0.227    -.0048921    .0011592
              |
     exercise |
           0  |  -.3539128   .5588587    -0.63   0.527    -1.449256    .7414301
           1  |  -.0579374   .4316468    -0.13   0.893    -.9039497    .7880749
              |
       active |
           0  |   .2613779   .6845577     0.38   0.703     -1.08033    1.603086
           1  |  -.6861916   .6739131    -1.02   0.309    -2.007037    .6346539
              |
         wt71 |   .0455018   .0833709     0.55   0.585    -.1179022    .2089058
              |
c.wt71#c.wt71 |  -.0009653   .0005247    -1.84   0.066    -.0019937    .0000631
              |
         qsmk |
Smoking ce..  |          0  (omitted)
smokeintens~y |          0  (omitted)
              |
         qsmk#|
           c. |
smokeintens~y |
Smoking ce..  |   .0466628   .0351448     1.33   0.184    -.0222197    .1155453
              |
        _cons |  -1.690608   4.388883    -0.39   0.700    -10.29266    6.911444
-------------------------------------------------------------------------------

(option mu assumed; predicted mean wt82_71)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       meanY |      1,566      2.6383    3.034683  -10.87582   9.876489

      +----------+
      |    meanY |
      |----------|
 960. | .3421569 |
      +----------+

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     wt82_71 |      1,566      2.6383    7.879913  -41.28047   48.53839</code></pre>
</div>
<div id="program-13.2-1" class="section level2 hasAnchor">
<h2>Program 13.2<a href="standardization-and-the-parametric-g-formula-stata.html#program-13.2-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Standardizing the mean outcome to the baseline confounders</li>
<li>Data from Table 2.2</li>
<li>Section 13.3</li>
</ul>
<div class="sourceCode" id="cb371"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb371-1"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb371-2"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-2" aria-hidden="true" tabindex="-1"></a>input str10 ID L A Y</span>
<span id="cb371-3"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Rheia&quot;</span>     0 0 0 </span>
<span id="cb371-4"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Kronos&quot;</span>    0 0 1 </span>
<span id="cb371-5"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Demeter&quot;</span>   0 0 0 </span>
<span id="cb371-6"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Hades&quot;</span>     0 0 0 </span>
<span id="cb371-7"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Hestia&quot;</span>    0 1 0 </span>
<span id="cb371-8"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Poseidon&quot;</span>  0 1 0 </span>
<span id="cb371-9"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Hera&quot;</span>      0 1 0 </span>
<span id="cb371-10"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Zeus&quot;</span>      0 1 1 </span>
<span id="cb371-11"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Artemis&quot;</span>   1 0 1</span>
<span id="cb371-12"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Apollo&quot;</span>    1 0 1</span>
<span id="cb371-13"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Leto&quot;</span>      1 0 0</span>
<span id="cb371-14"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Ares&quot;</span>      1 1 1</span>
<span id="cb371-15"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Athena&quot;</span>    1 1 1</span>
<span id="cb371-16"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-16" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Hephaestus&quot;</span> 1 1 1</span>
<span id="cb371-17"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-17" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Aphrodite&quot;</span> 1 1 1</span>
<span id="cb371-18"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-18" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Cyclope&quot;</span>   1 1 1</span>
<span id="cb371-19"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-19" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Persephone&quot;</span> 1 1 1</span>
<span id="cb371-20"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-20" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Hermes&quot;</span>    1 1 0</span>
<span id="cb371-21"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Hebe&quot;</span>      1 1 0</span>
<span id="cb371-22"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Dionysus&quot;</span>  1 1 0 </span>
<span id="cb371-23"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb371-24"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-25"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-25" aria-hidden="true" tabindex="-1"></a><span class="co">/* i. Data set up for standardization: </span></span>
<span id="cb371-26"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-26" aria-hidden="true" tabindex="-1"></a><span class="co"> - create 3 copies of each subject first, </span></span>
<span id="cb371-27"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-27" aria-hidden="true" tabindex="-1"></a><span class="co"> - duplicate the dataset and create a variable `interv` which indicates</span></span>
<span id="cb371-28"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-28" aria-hidden="true" tabindex="-1"></a><span class="co">which copy is the duplicate (interv =1) */</span></span>
<span id="cb371-29"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-29" aria-hidden="true" tabindex="-1"></a>expand 2, <span class="kw">generate</span>(interv)</span>
<span id="cb371-30"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-31"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-31" aria-hidden="true" tabindex="-1"></a><span class="co">/* Next, duplicate the original copy (interv = 0) again, and create</span></span>
<span id="cb371-32"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-32" aria-hidden="true" tabindex="-1"></a><span class="co">another variable &#39;interv2&#39; to indicate the copy */</span></span>
<span id="cb371-33"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-33" aria-hidden="true" tabindex="-1"></a>expand 2 <span class="kw">if</span> interv == 0, <span class="kw">generate</span>(interv2)</span>
<span id="cb371-34"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-35"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-35" aria-hidden="true" tabindex="-1"></a><span class="co">/* Now, change the value of &#39;interv&#39; to -1 in one of the copies so that</span></span>
<span id="cb371-36"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-36" aria-hidden="true" tabindex="-1"></a><span class="co">there are unique values of interv for each copy */</span></span>
<span id="cb371-37"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-37" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> interv = -1  <span class="kw">if</span> interv2 ==1</span>
<span id="cb371-38"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-38" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> interv2</span>
<span id="cb371-39"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-40"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-40" aria-hidden="true" tabindex="-1"></a><span class="co">/* Check that the data has the structure you want: </span></span>
<span id="cb371-41"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-41" aria-hidden="true" tabindex="-1"></a><span class="co"> - there should be 1566 people in each of the 3 levels of interv*/</span></span>
<span id="cb371-42"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-42" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> interv</span>
<span id="cb371-43"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-44"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-44" aria-hidden="true" tabindex="-1"></a><span class="co">/* Two of the copies will be for computing the standardized result</span></span>
<span id="cb371-45"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-45" aria-hidden="true" tabindex="-1"></a><span class="co">for these two copies (interv = 0 and interv = 1), set the outcome to</span></span>
<span id="cb371-46"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-46" aria-hidden="true" tabindex="-1"></a><span class="co">missing and force qsmk to either 0 or 1, respectively.</span></span>
<span id="cb371-47"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-47" aria-hidden="true" tabindex="-1"></a><span class="co">You may need to edit this part of the code for your outcome and exposure variables */</span></span>
<span id="cb371-48"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-48" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Y = . <span class="kw">if</span> interv != -1</span>
<span id="cb371-49"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-49" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> A = 0 <span class="kw">if</span> interv == 0</span>
<span id="cb371-50"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-50" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> A = 1 <span class="kw">if</span> interv == 1</span>
<span id="cb371-51"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-52"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-52" aria-hidden="true" tabindex="-1"></a><span class="co">/* Check that the data has the structure you want: </span></span>
<span id="cb371-53"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-53" aria-hidden="true" tabindex="-1"></a><span class="co">for interv = -1, some people quit and some do not; </span></span>
<span id="cb371-54"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-54" aria-hidden="true" tabindex="-1"></a><span class="co">for interv = 0 or 1, noone quits or everyone quits, respectively */</span></span>
<span id="cb371-55"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-55" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> interv, <span class="kw">sort</span>: <span class="kw">summarize</span> A</span>
<span id="cb371-56"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-57"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-57" aria-hidden="true" tabindex="-1"></a>*ii.Estimation <span class="kw">in</span> original <span class="kw">sample</span>*</span>
<span id="cb371-58"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-58" aria-hidden="true" tabindex="-1"></a>*Now, we <span class="kw">do</span> a parametric regression with the covariates we want to <span class="kw">adjust</span> <span class="kw">for</span>*</span>
<span id="cb371-59"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-59" aria-hidden="true" tabindex="-1"></a>*You may need to edit <span class="kw">this</span> part <span class="kw">of</span> the code <span class="kw">for</span> the variables you want.*</span>
<span id="cb371-60"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-60" aria-hidden="true" tabindex="-1"></a>*Because the copies have <span class="fu">missing</span> Y, <span class="kw">this</span> will only <span class="kw">run</span> the regression <span class="kw">in</span> the</span>
<span id="cb371-61"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-61" aria-hidden="true" tabindex="-1"></a>*original copy.*</span>
<span id="cb371-62"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-62" aria-hidden="true" tabindex="-1"></a>*The <span class="kw">double</span> hash between A &amp; L creates a regression <span class="kw">model</span> with A and L and a </span>
<span id="cb371-63"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-63" aria-hidden="true" tabindex="-1"></a>* product term between A and L*</span>
<span id="cb371-64"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-64" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> Y A##L</span>
<span id="cb371-65"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-66"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-66" aria-hidden="true" tabindex="-1"></a>*Ask Stata <span class="kw">for</span> expected <span class="kw">values</span> - Stata will give you expected <span class="kw">values</span> <span class="kw">for</span> <span class="ot">all</span> </span>
<span id="cb371-67"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-67" aria-hidden="true" tabindex="-1"></a>* copies, <span class="kw">not</span> just the original ones*</span>
<span id="cb371-68"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-68" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> predY, <span class="kw">xb</span></span>
<span id="cb371-69"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-70"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-70" aria-hidden="true" tabindex="-1"></a>*Now ask <span class="kw">for</span> a summary <span class="kw">of</span> these <span class="kw">values</span> <span class="kw">by</span> intervention*</span>
<span id="cb371-71"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-71" aria-hidden="true" tabindex="-1"></a>*These are the standardized outcome <span class="kw">estimates</span>: you can subtract them to <span class="fu">get</span> the</span>
<span id="cb371-72"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-72" aria-hidden="true" tabindex="-1"></a>* standardized difference*</span>
<span id="cb371-73"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-73" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> interv, <span class="kw">sort</span>: <span class="kw">summarize</span> predY</span>
<span id="cb371-74"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-75"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-75" aria-hidden="true" tabindex="-1"></a>*iii.OPTIONAL: Output standardized point <span class="kw">estimates</span> and difference*</span>
<span id="cb371-76"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-76" aria-hidden="true" tabindex="-1"></a>*The summary from the <span class="fu">last</span> command gives you the standardized <span class="kw">estimates</span>*</span>
<span id="cb371-77"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-77" aria-hidden="true" tabindex="-1"></a>*We can stop there, <span class="kw">or</span> we can ask Stata to calculate the standardized difference</span>
<span id="cb371-78"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-78" aria-hidden="true" tabindex="-1"></a>* and <span class="kw">display</span> <span class="ot">all</span> the results <span class="kw">in</span> a simple <span class="kw">table</span>*</span>
<span id="cb371-79"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-79" aria-hidden="true" tabindex="-1"></a>*The code below can <span class="kw">be</span> used <span class="kw">as</span>-is without changing any <span class="kw">variable</span> names*</span>
<span id="cb371-80"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-80" aria-hidden="true" tabindex="-1"></a>*The option <span class="st">&quot;quietly&quot;</span> asks Stata <span class="kw">not</span> to <span class="kw">display</span> the output <span class="kw">of</span> some intermediate</span>
<span id="cb371-81"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-81" aria-hidden="true" tabindex="-1"></a>* calculations*</span>
<span id="cb371-82"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-82" aria-hidden="true" tabindex="-1"></a>*You can <span class="kw">delete</span> <span class="kw">this</span> option <span class="kw">if</span> you want to see what is happening step-<span class="kw">by</span>-step*</span>
<span id="cb371-83"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-83" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> predY <span class="kw">if</span>(interv == -1)</span>
<span id="cb371-84"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-84" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> input observe = (-1,<span class="ot">`r(mean)&#39;</span>)</span>
<span id="cb371-85"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-85" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> predY <span class="kw">if</span>(interv == 0)</span>
<span id="cb371-86"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-86" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> observe = (observe \0,<span class="ot">`r(mean)&#39;</span>)</span>
<span id="cb371-87"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-87" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> predY <span class="kw">if</span>(interv == 1)</span>
<span id="cb371-88"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-88" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> observe = (observe \1,<span class="ot">`r(mean)&#39;</span>)</span>
<span id="cb371-89"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-89" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> observe = (observe \., observe[3,2]-observe[2,2]) </span>
<span id="cb371-90"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-91"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-91" aria-hidden="true" tabindex="-1"></a>*Add some <span class="ot">row</span>/column descriptions and <span class="kw">print</span> results to screen*</span>
<span id="cb371-92"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-92" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">rownames</span> observe = observed E(Y(a=0)) E(Y(a=1)) difference</span>
<span id="cb371-93"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-93" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">colnames</span> observe = interv <span class="ot">value</span></span>
<span id="cb371-94"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-94" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> observe </span>
<span id="cb371-95"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-96"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-96" aria-hidden="true" tabindex="-1"></a>*to interpret these results:*</span>
<span id="cb371-97"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-97" aria-hidden="true" tabindex="-1"></a>*<span class="ot">row</span> 1, column 2, is the observed <span class="kw">mean</span> outcome <span class="ot">value</span> <span class="kw">in</span> our original <span class="kw">sample</span>*</span>
<span id="cb371-98"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-98" aria-hidden="true" tabindex="-1"></a>*<span class="ot">row</span> 2, column 2, is the <span class="kw">mean</span> outcome <span class="ot">value</span> <span class="kw">if</span> everyone had <span class="kw">not</span> quit smoking*</span>
<span id="cb371-99"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-99" aria-hidden="true" tabindex="-1"></a>*<span class="ot">row</span> 3, column 2, is the <span class="kw">mean</span> outcome <span class="ot">value</span> <span class="kw">if</span> everyone had quit smoking*</span>
<span id="cb371-100"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-100" aria-hidden="true" tabindex="-1"></a>*<span class="ot">row</span> 4, column 2, is the <span class="kw">mean</span> difference outcome <span class="ot">value</span> <span class="kw">if</span> everyone had quit </span>
<span id="cb371-101"><a href="standardization-and-the-parametric-g-formula-stata.html#cb371-101" aria-hidden="true" tabindex="-1"></a>* smoking compared to <span class="kw">if</span> everyone had <span class="kw">not</span> quit smoking*</span></code></pre></div>
<pre><code>             ID          L          A          Y
  1. &quot;Rheia&quot;         0 0 0 
  2. &quot;Kronos&quot;        0 0 1 
  3. &quot;Demeter&quot;       0 0 0 
  4. &quot;Hades&quot;         0 0 0 
  5. &quot;Hestia&quot;        0 1 0 
  6. &quot;Poseidon&quot;      0 1 0 
  7. &quot;Hera&quot;          0 1 0 
  8. &quot;Zeus&quot;          0 1 1 
  9. &quot;Artemis&quot;       1 0 1
 10. &quot;Apollo&quot;        1 0 1
 11. &quot;Leto&quot;          1 0 0
 12. &quot;Ares&quot;          1 1 1
 13. &quot;Athena&quot;        1 1 1
 14. &quot;Hephaestus&quot; 1 1 1
 15. &quot;Aphrodite&quot; 1 1 1
 16. &quot;Cyclope&quot;       1 1 1
 17. &quot;Persephone&quot; 1 1 1
 18. &quot;Hermes&quot;        1 1 0
 19. &quot;Hebe&quot;          1 1 0
 20. &quot;Dionysus&quot;      1 1     0 
 21. end

(20 observations created)

(20 observations created)

(20 real changes made)



  Expanded observation |
                  type |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
                    -1 |         20       33.33       33.33
  Original observation |         20       33.33       66.67
Duplicated observation |         20       33.33      100.00
-----------------------+-----------------------------------
                 Total |         60      100.00

(40 real changes made, 40 to missing)

(13 real changes made)

(7 real changes made)


--------------------------------------------------------------------------------
-&gt; interv = -1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
           A |         20         .65    .4893605          0          1

--------------------------------------------------------------------------------
-&gt; interv = Original

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
           A |         20           0           0          0          0

--------------------------------------------------------------------------------
-&gt; interv = Duplicat

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
           A |         20           1           0          1          1

      Source |       SS           df       MS      Number of obs   =        20
-------------+----------------------------------   F(3, 16)        =      1.07
       Model |  .833333333         3  .277777778   Prob &gt; F        =    0.3909
    Residual |  4.16666667        16  .260416667   R-squared       =    0.1667
-------------+----------------------------------   Adj R-squared   =    0.0104
       Total |           5        19  .263157895   Root MSE        =    .51031

------------------------------------------------------------------------------
           Y | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         1.A |   1.05e-16   .3608439     0.00   1.000    -.7649549    .7649549
         1.L |   .4166667    .389756     1.07   0.301    -.4095791    1.242912
             |
         A#L |
        1 1  |  -5.83e-17   .4959325    -0.00   1.000     -1.05133     1.05133
             |
       _cons |        .25   .2551552     0.98   0.342    -.2909048    .7909048
------------------------------------------------------------------------------



--------------------------------------------------------------------------------
-&gt; interv = -1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       predY |         20          .5     .209427        .25   .6666667

--------------------------------------------------------------------------------
-&gt; interv = Original

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       predY |         20          .5     .209427        .25   .6666667

--------------------------------------------------------------------------------
-&gt; interv = Duplicat

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       predY |         20          .5     .209427        .25   .6666667












observe[4,2]
               interv      value
  observed         -1  .50000001
 E(Y(a=0))          0  .50000001
 E(Y(a=1))          1  .50000001
difference          .          0</code></pre>
</div>
<div id="program-13.3-1" class="section level2 hasAnchor">
<h2>Program 13.3<a href="standardization-and-the-parametric-g-formula-stata.html#program-13.3-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Standardizing the mean outcome to the baseline confounders:</li>
<li>Data from NHEFS</li>
<li>Section 13.3</li>
</ul>
<div class="sourceCode" id="cb373"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb373-1"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ./<span class="kw">data</span>/nhefs-formatted, <span class="kw">clear</span></span>
<span id="cb373-2"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-3"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-3" aria-hidden="true" tabindex="-1"></a>*i.Data <span class="kw">set</span> up <span class="kw">for</span> standardization: create 3 copies <span class="kw">of</span> each subject*</span>
<span id="cb373-4"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-4" aria-hidden="true" tabindex="-1"></a>*first, duplicate the dataset and create a <span class="kw">variable</span> &#39;interv&#39; which indicates</span>
<span id="cb373-5"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-5" aria-hidden="true" tabindex="-1"></a>* which copy is the duplicate (interv =1)</span>
<span id="cb373-6"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-6" aria-hidden="true" tabindex="-1"></a>expand 2, <span class="kw">generate</span>(interv)</span>
<span id="cb373-7"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-8"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-8" aria-hidden="true" tabindex="-1"></a>*next, duplicate the original copy (interv = 0) again, and create another</span>
<span id="cb373-9"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-9" aria-hidden="true" tabindex="-1"></a>* <span class="kw">variable</span> &#39;interv2&#39; to indicate the copy</span>
<span id="cb373-10"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-10" aria-hidden="true" tabindex="-1"></a>expand 2 <span class="kw">if</span> interv == 0, <span class="kw">generate</span>(interv2)</span>
<span id="cb373-11"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-12"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-12" aria-hidden="true" tabindex="-1"></a>*now, change the <span class="ot">value</span> <span class="kw">of</span> &#39;interv&#39; to -1 <span class="kw">in</span> one <span class="kw">of</span> the copies so that there are</span>
<span id="cb373-13"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-13" aria-hidden="true" tabindex="-1"></a>* <span class="kw">unique</span> <span class="kw">values</span> <span class="kw">of</span> interv <span class="kw">for</span> each copy*</span>
<span id="cb373-14"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-14" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> interv = -1  <span class="kw">if</span> interv2 ==1</span>
<span id="cb373-15"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-15" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> interv2 </span>
<span id="cb373-16"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-17"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-17" aria-hidden="true" tabindex="-1"></a>*check that the <span class="kw">data</span> has the structure you want: there should <span class="kw">be</span> 1566 people <span class="kw">in</span></span>
<span id="cb373-18"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-18" aria-hidden="true" tabindex="-1"></a>* each <span class="kw">of</span> the 3 <span class="kw">levels</span> <span class="kw">of</span> interv*</span>
<span id="cb373-19"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-19" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> interv</span>
<span id="cb373-20"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-21"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-21" aria-hidden="true" tabindex="-1"></a>*<span class="kw">two</span> <span class="kw">of</span> the copies will <span class="kw">be</span> <span class="kw">for</span> computing the standardized result*</span>
<span id="cb373-22"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-22" aria-hidden="true" tabindex="-1"></a>*<span class="kw">for</span> these <span class="kw">two</span> copies (interv = 0 and interv = 1), <span class="kw">set</span> the outcome to <span class="fu">missing</span></span>
<span id="cb373-23"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-23" aria-hidden="true" tabindex="-1"></a>* and <span class="kw">force</span> qsmk to either 0 <span class="kw">or</span> 1, respectively*</span>
<span id="cb373-24"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-24" aria-hidden="true" tabindex="-1"></a>*you may need to edit <span class="kw">this</span> part <span class="kw">of</span> the code <span class="kw">for</span> your outcome and exposure variables*</span>
<span id="cb373-25"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-25" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> wt82_71 = . <span class="kw">if</span> interv != -1</span>
<span id="cb373-26"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-26" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> qsmk = 0 <span class="kw">if</span> interv == 0</span>
<span id="cb373-27"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-27" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> qsmk = 1 <span class="kw">if</span> interv == 1</span>
<span id="cb373-28"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-29"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-29" aria-hidden="true" tabindex="-1"></a>*check that the <span class="kw">data</span> has the structure you want: <span class="kw">for</span> interv = -1, some people</span>
<span id="cb373-30"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-30" aria-hidden="true" tabindex="-1"></a>* quit and some <span class="kw">do</span> <span class="kw">not</span>; <span class="kw">for</span> interv = 0 <span class="kw">or</span> 1, noone quits <span class="kw">or</span> everyone quits, respectively*</span>
<span id="cb373-31"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-31" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> interv, <span class="kw">sort</span>: <span class="kw">summarize</span> qsmk</span>
<span id="cb373-32"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-33"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-33" aria-hidden="true" tabindex="-1"></a>*ii.Estimation <span class="kw">in</span> original <span class="kw">sample</span>*</span>
<span id="cb373-34"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-34" aria-hidden="true" tabindex="-1"></a>*Now, we <span class="kw">do</span> a parametric regression with the covariates we want to <span class="kw">adjust</span> <span class="kw">for</span>*</span>
<span id="cb373-35"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-35" aria-hidden="true" tabindex="-1"></a>*You may need to edit <span class="kw">this</span> part <span class="kw">of</span> the code <span class="kw">for</span> the variables you want.*</span>
<span id="cb373-36"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-36" aria-hidden="true" tabindex="-1"></a>*Because the copies have <span class="fu">missing</span> wt82_71, <span class="kw">this</span> will only <span class="kw">run</span> the regression <span class="kw">in</span> </span>
<span id="cb373-37"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-37" aria-hidden="true" tabindex="-1"></a>* the original copy*</span>
<span id="cb373-38"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-38" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> wt82_71 qsmk sex race c.age##c.age ib(<span class="fu">last</span>).education <span class="co">///</span></span>
<span id="cb373-39"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-39" aria-hidden="true" tabindex="-1"></a>c.smokeintensity##c.smokeintensity c.smokeyrs##c.smokeyrs <span class="co">///</span></span>
<span id="cb373-40"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-40" aria-hidden="true" tabindex="-1"></a>ib(<span class="fu">last</span>).exercise ib(<span class="fu">last</span>).active c.wt71##c.wt71 qsmk#c.smokeintensity</span>
<span id="cb373-41"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-42"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-42" aria-hidden="true" tabindex="-1"></a>*Ask Stata <span class="kw">for</span> expected <span class="kw">values</span> - Stata will give you expected <span class="kw">values</span> <span class="kw">for</span> <span class="ot">all</span> </span>
<span id="cb373-43"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-43" aria-hidden="true" tabindex="-1"></a>* copies, <span class="kw">not</span> just the original ones*</span>
<span id="cb373-44"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-44" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> predY, <span class="kw">xb</span></span>
<span id="cb373-45"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-46"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-46" aria-hidden="true" tabindex="-1"></a>*Now ask <span class="kw">for</span> a summary <span class="kw">of</span> these <span class="kw">values</span> <span class="kw">by</span> intervention*</span>
<span id="cb373-47"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-47" aria-hidden="true" tabindex="-1"></a>*These are the standardized outcome <span class="kw">estimates</span>: you can subtract them to <span class="fu">get</span> the</span>
<span id="cb373-48"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-48" aria-hidden="true" tabindex="-1"></a>* standardized difference*</span>
<span id="cb373-49"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-49" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> interv, <span class="kw">sort</span>: <span class="kw">summarize</span> predY</span>
<span id="cb373-50"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-51"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-51" aria-hidden="true" tabindex="-1"></a><span class="co">/* iii.OPTIONAL: Output standardized point estimates and difference</span></span>
<span id="cb373-52"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-52" aria-hidden="true" tabindex="-1"></a><span class="co">- The summary from the last command gives you the </span></span>
<span id="cb373-53"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-53" aria-hidden="true" tabindex="-1"></a><span class="co">standardized estimates</span></span>
<span id="cb373-54"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-54" aria-hidden="true" tabindex="-1"></a><span class="co">- We can stop there, or we can ask Stata to calculate the </span></span>
<span id="cb373-55"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-55" aria-hidden="true" tabindex="-1"></a><span class="co">standardized difference and display all the results </span></span>
<span id="cb373-56"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-56" aria-hidden="true" tabindex="-1"></a><span class="co">in a simple table</span></span>
<span id="cb373-57"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-57" aria-hidden="true" tabindex="-1"></a><span class="co">- The code below can be used as-is without changing any</span></span>
<span id="cb373-58"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-58" aria-hidden="true" tabindex="-1"></a><span class="co">variable names</span></span>
<span id="cb373-59"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-59" aria-hidden="true" tabindex="-1"></a><span class="co">- The option `quietly` asks Stata not to display the output of </span></span>
<span id="cb373-60"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-60" aria-hidden="true" tabindex="-1"></a><span class="co">some intermediate calculations</span></span>
<span id="cb373-61"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-61" aria-hidden="true" tabindex="-1"></a><span class="co">- You can delete this option if you want to see what is </span></span>
<span id="cb373-62"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-62" aria-hidden="true" tabindex="-1"></a><span class="co">happening step-by-step */</span></span>
<span id="cb373-63"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-63" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> predY <span class="kw">if</span>(interv == -1)</span>
<span id="cb373-64"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-64" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> input observe = (-1,<span class="ot">`r(mean)&#39;</span>)</span>
<span id="cb373-65"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-65" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> predY <span class="kw">if</span>(interv == 0)</span>
<span id="cb373-66"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-66" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> observe = (observe \0,<span class="ot">`r(mean)&#39;</span>)</span>
<span id="cb373-67"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-67" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> predY <span class="kw">if</span>(interv == 1)</span>
<span id="cb373-68"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-68" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> observe = (observe \1,<span class="ot">`r(mean)&#39;</span>)</span>
<span id="cb373-69"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-69" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> observe = (observe \., observe[3,2]-observe[2,2]) </span>
<span id="cb373-70"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-71"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-71" aria-hidden="true" tabindex="-1"></a>* Add some <span class="ot">row</span>/column descriptions and <span class="kw">print</span> results to screen</span>
<span id="cb373-72"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-72" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">rownames</span> observe = observed E(Y(a=0)) E(Y(a=1)) difference</span>
<span id="cb373-73"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-73" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">colnames</span> observe = interv <span class="ot">value</span></span>
<span id="cb373-74"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-74" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> observe </span>
<span id="cb373-75"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-76"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-76" aria-hidden="true" tabindex="-1"></a><span class="co">/* To interpret these results:</span></span>
<span id="cb373-77"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-77" aria-hidden="true" tabindex="-1"></a><span class="co">- row 1, column 2, is the observed mean outcome value </span></span>
<span id="cb373-78"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-78" aria-hidden="true" tabindex="-1"></a><span class="co">in our original sample</span></span>
<span id="cb373-79"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-79" aria-hidden="true" tabindex="-1"></a><span class="co">- row 2, column 2, is the mean outcome value </span></span>
<span id="cb373-80"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-80" aria-hidden="true" tabindex="-1"></a><span class="co">if everyone had not quit smoking</span></span>
<span id="cb373-81"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-81" aria-hidden="true" tabindex="-1"></a><span class="co">- row 3, column 2, is the mean outcome value </span></span>
<span id="cb373-82"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-82" aria-hidden="true" tabindex="-1"></a><span class="co">if everyone had quit smoking</span></span>
<span id="cb373-83"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-83" aria-hidden="true" tabindex="-1"></a><span class="co">- row 4, column 2, is the mean difference outcome value </span></span>
<span id="cb373-84"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-84" aria-hidden="true" tabindex="-1"></a><span class="co">if everyone had quit smoking compared to if everyone </span></span>
<span id="cb373-85"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-85" aria-hidden="true" tabindex="-1"></a><span class="co">had not quit smoking */</span></span>
<span id="cb373-86"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-87"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-87" aria-hidden="true" tabindex="-1"></a><span class="co">/* Addition due to way Statamarkdown works </span></span>
<span id="cb373-88"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-88" aria-hidden="true" tabindex="-1"></a><span class="co">i.e. each code chunk is a separate Stata session */</span></span>
<span id="cb373-89"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-89" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> observe = st_matrix(<span class="st">&quot;observe&quot;</span>)</span>
<span id="cb373-90"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-90" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">mata</span> matsave ./<span class="kw">data</span>/observe observe, <span class="kw">replace</span></span>
<span id="cb373-91"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-92"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-92" aria-hidden="true" tabindex="-1"></a>*<span class="kw">drop</span> the copies*</span>
<span id="cb373-93"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-93" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> interv != -1</span>
<span id="cb373-94"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-94" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> meanY_b =.</span>
<span id="cb373-95"><a href="standardization-and-the-parametric-g-formula-stata.html#cb373-95" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">save</span> ./<span class="kw">data</span>/nhefs_std, <span class="kw">replace</span></span></code></pre></div>
<pre><code>(1,566 observations created)

(1,566 observations created)

(1,566 real changes made)



  Expanded observation |
                  type |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
                    -1 |      1,566       33.33       33.33
  Original observation |      1,566       33.33       66.67
Duplicated observation |      1,566       33.33      100.00
-----------------------+-----------------------------------
                 Total |      4,698      100.00

(3,132 real changes made, 3,132 to missing)

(403 real changes made)

(1,163 real changes made)


--------------------------------------------------------------------------------
-&gt; interv = -1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        qsmk |      1,566    .2573436    .4373099          0          1

--------------------------------------------------------------------------------
-&gt; interv = Original

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        qsmk |      1,566           0           0          0          0

--------------------------------------------------------------------------------
-&gt; interv = Duplicat

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        qsmk |      1,566           1           0          1          1

      Source |       SS           df       MS      Number of obs   =     1,566
-------------+----------------------------------   F(20, 1545)     =     13.45
       Model |   14412.558        20    720.6279   Prob &gt; F        =    0.0000
    Residual |  82763.0286     1,545  53.5683033   R-squared       =    0.1483
-------------+----------------------------------   Adj R-squared   =    0.1373
       Total |  97175.5866     1,565  62.0930266   Root MSE        =     7.319

-------------------------------------------------------------------------------
      wt82_71 | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
         qsmk |   2.559594   .8091486     3.16   0.002     .9724486     4.14674
          sex |  -1.430272   .4689576    -3.05   0.002    -2.350132   -.5104111
         race |   .5601096   .5818888     0.96   0.336    -.5812656    1.701485
          age |   .3596353   .1633188     2.20   0.028     .0392854    .6799851
              |
  c.age#c.age |   -.006101   .0017261    -3.53   0.000    -.0094868   -.0027151
              |
    education |
           1  |    .194977   .7413692     0.26   0.793    -1.259219    1.649173
           2  |   .9854211   .7012116     1.41   0.160     -.390006    2.360848
           3  |   .7512894   .6339153     1.19   0.236    -.4921358    1.994715
           4  |   1.686547   .8716593     1.93   0.053    -.0232138    3.396307
              |
smokeintens~y |   .0491365   .0517254     0.95   0.342     -.052323    .1505959
              |
           c. |
smokeintens~y#|
           c. |
smokeintens~y |  -.0009907    .000938    -1.06   0.291    -.0028306    .0008493
              |
     smokeyrs |   .1343686   .0917122     1.47   0.143     -.045525    .3142621
              |
   c.smokeyrs#|
   c.smokeyrs |  -.0018664   .0015437    -1.21   0.227    -.0048944    .0011616
              |
     exercise |
           0  |  -.3539128   .5588587    -0.63   0.527    -1.450114    .7422889
           1  |  -.0579374   .4316468    -0.13   0.893     -.904613    .7887381
              |
       active |
           0  |   .2613779   .6845577     0.38   0.703    -1.081382    1.604138
           1  |  -.6861916   .6739131    -1.02   0.309    -2.008073    .6356894
              |
         wt71 |   .0455018   .0833709     0.55   0.585    -.1180303    .2090339
              |
c.wt71#c.wt71 |  -.0009653   .0005247    -1.84   0.066    -.0019945    .0000639
              |
         qsmk#|
           c. |
smokeintens~y |
Smoking ce..  |   .0466628   .0351448     1.33   0.184    -.0222737    .1155993
              |
        _cons |  -1.690608   4.388883    -0.39   0.700     -10.2994    6.918188
-------------------------------------------------------------------------------



--------------------------------------------------------------------------------
-&gt; interv = -1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       predY |      1,566      2.6383    3.034683  -10.87582   9.876489

--------------------------------------------------------------------------------
-&gt; interv = Original

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       predY |      1,566    1.756213    2.826271  -11.83737   6.733498

--------------------------------------------------------------------------------
-&gt; interv = Duplicat

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       predY |      1,566    5.273587    2.920532  -9.091126    11.0506












observe[4,2]
               interv      value
  observed         -1  2.6382998
 E(Y(a=0))          0  1.7562131
 E(Y(a=1))          1  5.2735873
difference          .  3.5173742


(saving observe[4,2])
file ./data/observe.mmat saved

(3,132 observations deleted)

(1,566 missing values generated)</code></pre>
</div>
<div id="program-13.4-1" class="section level2 hasAnchor">
<h2>Program 13.4<a href="standardization-and-the-parametric-g-formula-stata.html#program-13.4-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Computing the 95% confidence interval of the standardized means and their difference: Data from NHEFS</li>
<li>Section 13.3</li>
</ul>
<div class="sourceCode" id="cb375"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb375-1"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-1" aria-hidden="true" tabindex="-1"></a>*Run <span class="kw">program</span> 13.3 to obtain point <span class="kw">estimates</span>, and then the code below*</span>
<span id="cb375-2"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-3"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-3" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> bootstdz</span>
<span id="cb375-4"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-5"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-5" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> bootstdz, rclass</span>
<span id="cb375-6"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ./<span class="kw">data</span>/nhefs_std, <span class="kw">clear</span></span>
<span id="cb375-7"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-8"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-8" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb375-9"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-10"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-10" aria-hidden="true" tabindex="-1"></a>* Draw <span class="kw">bootstrap</span> <span class="kw">sample</span> from original observations</span>
<span id="cb375-11"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-11" aria-hidden="true" tabindex="-1"></a><span class="kw">bsample</span> </span>
<span id="cb375-12"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb375-13"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-13" aria-hidden="true" tabindex="-1"></a><span class="co">/* Create copies with each value of qsmk in bootstrap sample.</span></span>
<span id="cb375-14"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-14" aria-hidden="true" tabindex="-1"></a><span class="co">First, duplicate the dataset and create a variable `interv` which</span></span>
<span id="cb375-15"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-15" aria-hidden="true" tabindex="-1"></a><span class="co">indicates which copy is the duplicate (interv =1)*/</span></span>
<span id="cb375-16"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-16" aria-hidden="true" tabindex="-1"></a>expand 2, <span class="kw">generate</span>(interv_b)</span>
<span id="cb375-17"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-18"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-18" aria-hidden="true" tabindex="-1"></a><span class="co">/* Next, duplicate the original copy (interv = 0) again, and create</span></span>
<span id="cb375-19"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-19" aria-hidden="true" tabindex="-1"></a><span class="co">another variable `interv2` to indicate the copy*/</span></span>
<span id="cb375-20"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-20" aria-hidden="true" tabindex="-1"></a>expand 2 <span class="kw">if</span> interv_b == 0, <span class="kw">generate</span>(interv2_b)</span>
<span id="cb375-21"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-22"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-22" aria-hidden="true" tabindex="-1"></a><span class="co">/* Now, change the value of interv to -1 in one of the copies so that</span></span>
<span id="cb375-23"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-23" aria-hidden="true" tabindex="-1"></a><span class="co">there are unique values of interv for each copy*/</span></span>
<span id="cb375-24"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-24" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> interv_b = -1  <span class="kw">if</span> interv2_b ==1</span>
<span id="cb375-25"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-25" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> interv2_b</span>
<span id="cb375-26"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-27"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-27" aria-hidden="true" tabindex="-1"></a><span class="co">/* Two of the copies will be for computing the standardized result.</span></span>
<span id="cb375-28"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-28" aria-hidden="true" tabindex="-1"></a><span class="co">For these two copies (interv = 0 and interv = 1), set the outcome to</span></span>
<span id="cb375-29"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-29" aria-hidden="true" tabindex="-1"></a><span class="co">missing and force qsmk to either 0 or 1, respectively*/</span></span>
<span id="cb375-30"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-30" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> wt82_71 = . <span class="kw">if</span> interv_b != -1</span>
<span id="cb375-31"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-31" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> qsmk = 0 <span class="kw">if</span> interv_b == 0</span>
<span id="cb375-32"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-32" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> qsmk = 1 <span class="kw">if</span> interv_b == 1</span>
<span id="cb375-33"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-34"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-34" aria-hidden="true" tabindex="-1"></a>* Run regression</span>
<span id="cb375-35"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-35" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> wt82_71 qsmk sex race c.age##c.age ib(<span class="fu">last</span>).education <span class="co">///</span></span>
<span id="cb375-36"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-36" aria-hidden="true" tabindex="-1"></a>  c.smokeintensity##c.smokeintensity c.smokeyrs##c.smokeyrs <span class="co">///</span></span>
<span id="cb375-37"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-37" aria-hidden="true" tabindex="-1"></a>  ib(<span class="fu">last</span>).exercise ib(<span class="fu">last</span>).active c.wt71##c.wt71 <span class="co">///</span></span>
<span id="cb375-38"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-38" aria-hidden="true" tabindex="-1"></a>  qsmk#c.smokeintensity</span>
<span id="cb375-39"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-40"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-40" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ask Stata for expected values.</span></span>
<span id="cb375-41"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-41" aria-hidden="true" tabindex="-1"></a><span class="co">Stata will give you expected values for all copies, not just the</span></span>
<span id="cb375-42"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-42" aria-hidden="true" tabindex="-1"></a><span class="co">original ones*/</span></span>
<span id="cb375-43"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-43" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> predY_b, <span class="kw">xb</span></span>
<span id="cb375-44"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-44" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> predY_b <span class="kw">if</span> interv_b == 0</span>
<span id="cb375-45"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-45" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="fu">scalar</span> boot_0 = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb375-46"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-46" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> predY_b <span class="kw">if</span> interv_b == 1</span>
<span id="cb375-47"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-47" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="fu">scalar</span> boot_1 = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb375-48"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-48" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="fu">scalar</span> boot_diff = <span class="fu">return</span>(boot_1) - <span class="fu">return</span>(boot_0)</span>
<span id="cb375-49"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-49" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> meanY_b</span>
<span id="cb375-50"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-51"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-51" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span></span>
<span id="cb375-52"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-53"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-53" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb375-54"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-55"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-55" aria-hidden="true" tabindex="-1"></a><span class="co">/* Then we use the `simulate` command to run the bootstraps as many</span></span>
<span id="cb375-56"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-56" aria-hidden="true" tabindex="-1"></a><span class="co">times as we want.</span></span>
<span id="cb375-57"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-57" aria-hidden="true" tabindex="-1"></a><span class="co">Start with reps(10) to make sure your code runs, and then change to</span></span>
<span id="cb375-58"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-58" aria-hidden="true" tabindex="-1"></a><span class="co">reps(1000) to generate your final CIs.*/</span></span>
<span id="cb375-59"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-59" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span> EY_a0=<span class="fu">r</span>(boot_0) EY_a1 = <span class="fu">r</span>(boot_1) <span class="co">///</span></span>
<span id="cb375-60"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-60" aria-hidden="true" tabindex="-1"></a>  difference = <span class="fu">r</span>(boot_diff), reps(10) <span class="dv">seed</span>(1): bootstdz</span>
<span id="cb375-61"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-62"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-62" aria-hidden="true" tabindex="-1"></a><span class="co">/* Next, format the point estimate to allow Stata to calculate our</span></span>
<span id="cb375-63"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-63" aria-hidden="true" tabindex="-1"></a><span class="co">standard errors and confidence intervals*/</span></span>
<span id="cb375-64"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb375-65"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-65" aria-hidden="true" tabindex="-1"></a>* Addition: read back <span class="kw">in</span> the observe <span class="fu">matrix</span>  </span>
<span id="cb375-66"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-66" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">mata</span> matuse ./<span class="kw">data</span>/observe, <span class="kw">replace</span></span>
<span id="cb375-67"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-67" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> st_matrix(<span class="st">&quot;observe&quot;</span>, observe)</span>
<span id="cb375-68"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-69"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-69" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> pe = observe[2..4, 2]&#39;</span>
<span id="cb375-70"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-70" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> pe</span>
<span id="cb375-71"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-72"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-72" aria-hidden="true" tabindex="-1"></a><span class="co">/* Finally, the bstat command generates valid 95% confidence intervals</span></span>
<span id="cb375-73"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-73" aria-hidden="true" tabindex="-1"></a><span class="co">under the normal approximation using our bootstrap results.</span></span>
<span id="cb375-74"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-74" aria-hidden="true" tabindex="-1"></a><span class="co">The default results use a normal approximation to calcutlate the</span></span>
<span id="cb375-75"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-75" aria-hidden="true" tabindex="-1"></a><span class="co">confidence intervals.</span></span>
<span id="cb375-76"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-76" aria-hidden="true" tabindex="-1"></a><span class="co">Note, n contains the original sample size of your data before censoring*/</span></span>
<span id="cb375-77"><a href="standardization-and-the-parametric-g-formula-stata.html#cb375-77" aria-hidden="true" tabindex="-1"></a><span class="kw">bstat</span>, stat(pe) n(1629) </span></code></pre></div>
<pre><code> 12. 

      Command: bootstdz
        EY_a0: r(boot_0)
        EY_a1: r(boot_1)
   difference: r(boot_diff)

Simulations (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........

(loading observe[4,2])




pe[1,3]
           r2         r3         r4
c2  1.7562131  5.2735873  3.5173742


Bootstrap results                                        Number of obs = 1,629
                                                         Replications  =    10

------------------------------------------------------------------------------
             |   Observed   Bootstrap                         Normal-based
             | coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       EY_a0 |   1.756213   .2157234     8.14   0.000     1.333403    2.179023
       EY_a1 |   5.273587   .4999001    10.55   0.000     4.293801    6.253374
  difference |   3.517374    .538932     6.53   0.000     2.461087    4.573662
------------------------------------------------------------------------------</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ip-weighting-and-marginal-structural-models-stata.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="g-estimation-of-structural-nested-models-stata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/remlapmot/cibookex-r/edit/master/13-stand-gformula-stata.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/remlapmot/cibookex-r/blob/master/13-stand-gformula-stata.Rmd",
"text": null
},
"download": ["cibookex-r.pdf", "cibookex-r.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
